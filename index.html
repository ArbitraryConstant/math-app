<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdaptiveMath - Learn at Your Pace</title>
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://cdnjs.cloudflare.com https://cdn.tailwindcss.com 'unsafe-inline' 'unsafe-eval';">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <!-- Core Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const MemoryStorage = {
            data: {},

            setItem: (key, value) => {
                MemoryStorage.data[key] = value;
            },

            getItem: (key) => {
                return MemoryStorage.data[key] || null;
            },

            removeItem: (key) => {
                delete MemoryStorage.data[key];
            },

            clear: () => {
                MemoryStorage.data = {};
            }
        };

        const SafeStorage = {
            setItem: (key, value) => {
                try {
                    localStorage.setItem(key, value);
                } catch (e) {
                    MemoryStorage.setItem(key, value);
                }
            },

            getItem: (key) => {
                try {
                    return localStorage.getItem(key);
                } catch (e) {
                    return MemoryStorage.getItem(key);
                }
            },

            removeItem: (key) => {
                try {
                    localStorage.removeItem(key);
                } catch (e) {
                    MemoryStorage.removeItem(key);
                }
            },

            clear: () => {
                try {
                    localStorage.clear();
                } catch (e) {
                    MemoryStorage.clear();
                }
            }
        };

        const Storage = SafeStorage;

        const SessionManager = {
            checkSession: () => {
                try {
                    const session = Storage.getItem('adaptivemath_session');
                    if (!session) return null;

                    const sessionData = JSON.parse(session);
                    const now = new Date().getTime();

                    if (now - sessionData.timestamp > 24 * 60 * 60 * 1000) {
                        Storage.removeItem('adaptivemath_session');
                        return null;
                    }

                    return sessionData.user;
                } catch (e) {
                    console.warn('Session check failed:', e);
                    return null;
                }
            },

            createSession: (user) => {
                try {
                    const sessionData = {
                        user,
                        timestamp: new Date().getTime()
                    };
                    Storage.setItem('adaptivemath_session', JSON.stringify(sessionData));
                } catch (e) {
                    console.warn('Failed to create session:', e);
                }
            },

            endSession: () => {
                try {
                    Storage.removeItem('adaptivemath_session');
                } catch (e) {
                    console.warn('Failed to end session:', e);
                }
            }
        };

        const App = () => {
            const [user, setUser] = React.useState(SessionManager.checkSession());

            const handleLogin = () => {
                const mockUser = { id: 'user1', name: 'Test User' };
                SessionManager.createSession(mockUser);
                setUser(mockUser);
            };

            const handleLogout = () => {
                SessionManager.endSession();
                setUser(null);
            };

            return (
                <div className="min-h-screen flex items-center justify-center bg-gray-100">
                    {!user ? (
                        <div className="text-center">
                            <h1 className="text-2xl font-bold mb-4">Welcome to AdaptiveMath</h1>
                            <button
                                onClick={handleLogin}
                                className="bg-blue-500 text-white px-4 py-2 rounded"
                            >
                                Log In
                            </button>
                        </div>
                    ) : (
                        <div className="text-center">
                            <h1 className="text-2xl font-bold mb-4">Hello, {user.name}!</h1>
                            <button
                                onClick={handleLogout}
                                className="bg-red-500 text-white px-4 py-2 rounded"
                            >
                                Log Out
                            </button>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
